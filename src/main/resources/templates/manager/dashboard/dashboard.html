<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{manager/layout/layout_admin}">
<head>
    <meta charset="UTF-8"/>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

</head>
<body>
<div layout:fragment="content">
    <div class="row g-3 mb-3">
        <div class="col-3">
            <div class="metric users p-4 h-100">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="label">S·ªë ng∆∞·ªùi d√πng</div>
                        <div class="value" th:text="${stats.totalUsers}">0</div>
                        <div class="chip mt-1" th:if="${stats.deltaUsersWeek} != null"
                             th:text="'‚Üë ' + ${stats.deltaUsersWeek} + ' trong 7 ng√†y'">‚Üë 0 trong 7 ng√†y</div>
                    </div>
                    <span class="fs-2">üë§</span>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="metric products p-4 h-100">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="label">S·ªë s·∫£n ph·∫©m</div>
                        <div class="value" th:text="${stats.totalProducts}">0</div>
                        <div class="chip mt-1" th:text="${stats.activeProducts} + ' ƒëang b√°n'">0 ƒëang b√°n</div>
                    </div>
                    <span class="fs-2">üì¶</span>
                </div>
            </div>
        </div>

        <div class="col-3">
            <div class="metric orders p-4 h-100">
                <div class="label">T·ªïng ƒë∆°n h√†ng</div>
                <div class="value" th:text="${stats.totalOrders}">0</div>
                <div class="small mt-1"
                     th:classappend="${stats.orderTrendUp} ? ' text-success' : ' text-danger'"
                     th:text="${stats.orderTrendUp} ? '‚Üë TƒÉng so v·ªõi tu·∫ßn tr∆∞·ªõc' : '‚Üì Gi·∫£m so v·ªõi tu·∫ßn tr∆∞·ªõc'">--</div>
            </div>
        </div>

        <div class="col-3">
            <div class="metric revenue p-4 h-100">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="label">Doanh thu h√¥m nay</div>
                        <div class="value">
                            <span th:text="${#numbers.formatDecimal(stats.revenueToday, 0, 'COMMA', 0, 'POINT')}">0</span>
                            <span class="fs-6">‚Ç´</span>
                        </div>
                        <div class="small text-muted"
                             th:text="'Th√°ng n√†y: ' + ${#numbers.formatDecimal(stats.revenueThisMonth, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'">
                            Th√°ng n√†y: 0 ‚Ç´
                        </div>
                    </div>
                    <span class="fs-2">üí∞</span>
                </div>
            </div>
        </div>
    </div>
    <div class="row g-3 mb-4">
        <div class="col-12 col-xl-7">
            <div class="card h-100">
                <div class="card-header bg-white">ƒê∆°n h√†ng 7 ng√†y g·∫ßn nh·∫•t</div>
                <div class="card-body"><canvas id="ordersLine"></canvas></div>
            </div>
        </div>
        <div class="col-12 col-xl-5">
            <div class="card h-100">
                <div class="card-header bg-white">Doanh thu theo danh m·ª•c (th√°ng n√†y)</div>
                <div class="card-body"><canvas id="revenueBar"></canvas></div>
            </div>
        </div>
    </div>
    <div class="row g-3">
        <div class="col-12 col-xl-7">
            <div class="card h-100">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <span>ƒê∆°n h√†ng m·ªõi</span>
                    <a class="btn btn-sm btn-primary" th:href="@{/admin/orders}">Xem t·∫•t c·∫£</a>
                </div>
                <div class="table-responsive">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>Ng√†y</th>
                            <th class="text-end">T·ªïng (‚Ç´)</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="o : ${recentOrders}">
                            <td th:text="${o.code}">ORD-0001</td>
                            <td th:text="${o.customerName}">Nguy·ªÖn VƒÉn A</td>
                            <td th:text="${#dates.format(o.createdAt, 'dd/MM HH:mm')}">01/09 10:00</td>
                            <td class="text-end" th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 0, 'POINT')}">0</td>
                            <td>
<span class="badge rounded-pill" th:classappend="${o.status}=='PAID' ? ' text-bg-success' : (${o.status}=='PENDING' ? ' text-bg-warning' : ' text-bg-secondary')"
      th:text="${o.status}">PENDING</span>
                            </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(recentOrders)}">
                            <td colspan="5" class="text-center text-muted py-4">Ch∆∞a c√≥ ƒë∆°n h√†ng</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-12 col-xl-5">
            <div class="card h-100">
                <div class="card-header bg-white">S·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng</div>
                <div class="table-responsive">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>T√™n</th>
                            <th class="text-center">T·ªìn kho</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="p: ${lowStocks}">
                            <td>
                                <div class="d-flex align-items-center gap-2">
                                    <img th:src="${p.thumbnailUrl}" alt="thumb" width="36" height="36" class="rounded border" />
                                    <span th:text="${p.name}">S·∫£n ph·∫©m</span>
                                </div>
                            </td>
                            <td class="text-center" th:text="${p.qty}">0</td>
                            <td class="text-end"><a th:href="@{'/admin/products/' + ${p.id}}" class="btn btn-sm btn-outline-primary">Chi ti·∫øt</a></td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(lowStocks)}">
                            <td colspan="3" class="text-center text-muted py-4">Kh√¥ng c√≥ c·∫£nh b√°o t·ªìn kho</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        const ordersSeries = /*[[${chart.ordersByDay.values}]]*/ [12,10,9,8,15,20,7];
        const ordersLabels = /*[[${chart.ordersByDay.labels}]]*/ ["T2","T3","T4","T5","T6","T7","CN"];
        const revLabels = /*[[${chart.revenueByCategory.labels}]]*/ ["Nh·∫´n","D√¢y chuy·ªÅn","V√≤ng tay","B√¥ng tai"];
        const revSeries = /*[[${chart.revenueByCategory.values}]]*/ [12000000, 9000000, 7000000, 3000000];
        new Chart(document.getElementById('ordersLine'), {type:'line', data:{labels:ordersLabels, datasets:[{label:'ƒê∆°n h√†ng', data:ordersSeries, tension:.35}]}});
        new Chart(document.getElementById('revenueBar'), {type:'bar', data:{labels:revLabels, datasets:[{label:'Doanh thu (‚Ç´)', data:revSeries}]}});
    </script>
</div>
</body>
</html>