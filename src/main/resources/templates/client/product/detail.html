<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title th:text="${product != null ? product.name : 'PNJ - Chi tiết sản phẩm'}">PNJ - Chi tiết sản phẩm</title>

    <!-- Bootstrap + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- App styles -->
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body class="bg-white">

<header th:replace="client/layout/header :: header"></header>

<!-- PRODUCT -->
<section class="container my-4"
         th:with="
            d=${product != null && product.discount != null ? product.discount : 0},
            hasDiscount=${d > 0},
            effectivePrice=${hasDiscount ? (product.price * (100 - d)) / 100 : product.price},
            imgs=${product != null && !#lists.isEmpty(product.imageUrls) ? product.imageUrls : '/images/placeholder.jpg'},
            mainImage=${imgs[0]},
            monthly=${effectivePrice / 12}
         ">
    <div class="row g-3">
        <!-- THUMBNAILS -->
        <div class="col-12 col-md-1 order-2 order-md-1">
            <div class="d-flex d-md-block gap-2 thumb-list">
                <img class="thumb"
                     th:each="img,idx : ${imgs}"
                     th:src="${img}"
                     th:alt="'thumb ' + ${idx.index + 1}"
                     loading="lazy">
            </div>
        </div>

        <!-- MAIN IMAGE -->
        <div class="col-12 col-md-6 order-1 order-md-2 ps-md-4">
            <div class="bg-white p-2 rounded-4 h-100 d-flex align-items-center justify-content-center border">
                <img id="mainImage" class="img-fluid rounded-3"
                     th:src="${mainImage}"
                     alt="main">
            </div>
        </div>

        <!-- RIGHT PANEL -->
        <div class="col-12 col-md-5 order-3">
            <h1 class="h5 mb-1" th:text="${product.getDisplayName()}">Tên sản phẩm</h1>
            <div class="text-muted small mb-2">
                Mã SP:
                <span class="fw-semibold" th:text="${product.serialNumber}">SERIAL-001</span>
            </div>

            <!-- Giá hiện tại + badge giảm -->
            <div class="d-flex align-items-baseline gap-2 mb-1">
                <div class="price fs-3 fw-bold"
                     th:text="${#numbers.formatDecimal(effectivePrice, 0, 'POINT', 0, 'COMMA')} + ' ₫'">
                    0 ₫
                </div>
                <span class="badge rounded-pill bg-warning text-dark fw-semibold"
                      th:if="${hasDiscount}"
                      th:text="'-' + ${d} + '%'">-0%</span>
            </div>

            <!-- Giá gốc (gạch ngang) -->
            <div class="small text-secondary mb-2 text-decoration-line-through"
                 th:if="${hasDiscount}"
                 th:text="${#numbers.formatDecimal(product.price, 0, 'POINT', 0, 'COMMA')} + ' đ'">
                0 đ
            </div>

            <!-- Trả góp/tháng (tính nhanh 12 tháng) -->
            <div class="small text-secondary mb-3">
                Chỉ cần trả <strong th:text="${#numbers.formatDecimal(monthly, 0, 'POINT', 0, 'COMMA')} + ' đ/tháng'">0 đ/tháng</strong>
            </div>

            <div class="mb-3">
                <div class="small fw-semibold mb-2">Chọn size *</div>
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="size" id="s17" checked>
                    <label class="btn btn-outline-dark" for="s17">17</label>
                    <input type="radio" class="btn-check" name="size" id="s18">
                    <label class="btn btn-outline-dark" for="s18">18</label>
                    <input type="radio" class="btn-check" name="size" id="s19">
                    <label class="btn btn-outline-dark" for="s19">19</label>
                </div>
                <a class="small ms-2 text-decoration-none" th:href="@{/size-guide}">Cách đo size nhẫn</a>
            </div>

            <div class="mb-3">
                <div class="d-flex align-items-start gap-2 small p-2 rounded-3 bg-white border">
                    <i class="bi bi-percent fw-bold text-success"></i>
                    <div>Ưu đãi thêm đến <strong>300K</strong> khi thanh toán quét <strong>VNPAY-QR</strong></div>
                </div>
            </div>

            <div class="row g-2 small mb-3">
                <div class="col-4">
                    <div class="p-2 bg-white border rounded-3 text-center h-100">
                        <i class="bi bi-truck"></i> <span class="d-block">Miễn phí giao hàng</span>
                    </div>
                </div>
                <div class="col-4">
                    <div class="p-2 bg-white border rounded-3 text-center h-100">
                        <i class="bi bi-headset"></i> <span class="d-block">Phục vụ 24/7</span>
                    </div>
                </div>
                <div class="col-4">
                    <div class="p-2 bg-white border rounded-3 text-center h-100">
                        <i class="bi bi-arrow-repeat"></i> <span class="d-block">Thu đổi 48h</span>
                    </div>
                </div>
            </div>

            <div class="d-flex flex-column gap-2">

                <!-- Mua ngay -->
                <a class="btn btn-warning fw-semibold rounded-3 py-2" th:href="@{/checkout/{serialNumber}(serialNumber=${product.serialNumber})}">
                    Mua ngay <br>
                    <small class="fst-italic fw-normal">(Giao hàng miễn phí tận nhà hoặc nhận tại cửa hàng)</small>
                </a>

                <!-- Hàng 2: 2 nút ngang -->
                <div class="d-flex gap-2">
                    <form th:action="@{/cart/add/{serialnumber}(serialnumber=${product.serialNumber})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button class="btn btn-outline-warning flex-fill fw-semibold" type="submit">
                            Thêm vào giỏ hàng
                        </button>
                    </form>
                    <button class="btn btn-primary flex-fill fw-semibold">
                        Trả góp 0% <br>
                    </button>
                </div>

            </div>



            <div class="small text-muted mt-2">
                <i class="bi bi-geo-alt"></i>
                <span th:text="${'Còn ' + product.stockQuantity + ' sản phẩm trong kho'}">Còn hàng</span>
            </div>
        </div>
    </div>
</section>

<!-- TABS -->
<section class="container my-4">
    <ul class="nav nav-tabs" id="pills" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#policy" type="button" role="tab">Chính sách hậu mãi</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#desc" type="button" role="tab">Mô tả sản phẩm</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#faq" type="button" role="tab">Câu hỏi thường gặp</button>
        </li>
    </ul>
    <div class="tab-content bg-white border border-top-0 rounded-bottom p-3">
        <div id="policy" class="tab-pane fade show active">
            <ul class="mb-0">
                <li>Miễn phí đổi size 48h tại hệ thống cửa hàng.</li>
                <li>Vệ sinh, xi mới miễn phí trọn đời.</li>
                <li>Bảo hành tiêu chuẩn nhà sản xuất.</li>
            </ul>
        </div>
        <div id="desc" class="tab-pane fade">
            <table class="table table-sm w-auto">
                <tr><td>Chất liệu</td><td th:text="${product.material}">—</td></tr>
                <tr><td>Loại đá</td><td th:text="${product.gemstone}">—</td></tr>
                <tr><td>Giới tính</td><td th:text="${product.gender}">—</td></tr>
                <tr><td>Thương hiệu</td><td th:text="${product.brand}">—</td></tr>
                <tr><td>Mã sản phẩm</td><td th:text="${product.serialNumber}">—</td></tr>
            </table>
        </div>
        <div id="faq" class="tab-pane fade">
            <p class="mb-1"><strong>Hỏi:</strong> Có thể đặt làm theo size riêng không?</p>
            <p><strong>Đáp:</strong> Có, vui lòng liên hệ để được tư vấn chi tiết.</p>
        </div>
    </div>
</section>

<footer th:replace="client/layout/footer :: footer"></footer>
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script defer th:src="@{/js/home.js}"></script>
</body>
</html>
