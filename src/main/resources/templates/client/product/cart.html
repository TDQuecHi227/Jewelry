<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Giỏ Hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body{background:#f5f6f8}
        .cart-wrap{max-width:1000px;margin:30px auto}
        .card-cart{border-radius:14px;overflow:hidden}
        .cart-head{border-bottom:1px solid #eee;background:#fafafa}
        .prod-img{width:80px;height:80px;object-fit:contain;border:1px solid #eee;border-radius:8px;background:#fff}
        .qty .btn{min-width:40px}
        .qty input{width:60px;text-align:center}
        .price{font-weight:700;color:#d4a017;font-size:1rem}
        .line-muted{color:#6b7280}
        .btn-continue{height:50px;border-radius:10px;background:#003366;color:#fff;font-weight:600;font-size:1rem}
        .btn-continue:hover{opacity:.9}
        .btn-icon{color:#6b7280}
        .btn-icon:hover{color:#ef4444}
        .totals-box{background:#fafafa;border-radius:12px;padding:16px}
    </style>
</head>
<body>

<header th:replace="client/layout/header :: header"></header>

<div class="cart-wrap">
    <div class="card card-cart shadow-sm">
        <!-- Header -->
        <div class="card-body cart-head d-flex align-items-center justify-content-between">
            <a href="#"
               class="text-decoration-none small"
               onclick="if (history.length > 1) { history.back(); } else { window.location='/' } return false;">
                &larr; Quay lại
            </a>
            <h5 class="fw-semibold mb-0">Giỏ Hàng</h5>
        </div>

        <!-- Checkbox chọn tất cả -->
        <div class="px-3 py-2">
            <input type="checkbox" id="checkAll" class="form-check-input me-2">
            <label for="checkAll">Chọn tất cả (<span th:text="${#lists.size(carts)}">0</span> sản phẩm)</label>
        </div>

        <!-- Danh sách sản phẩm -->
        <div class="list-group list-group-flush">
            <div class="list-group-item py-3" th:each="ci,iter : ${carts}" th:attr="data-item-id=${ci.id}">
                <div class="d-flex align-items-center gap-3">
                    <!-- tick -->
                    <input class="form-check-input item-check" type="checkbox" checked>

                    <!-- image -->
                    <img class="prod-img"
                         th:src="${ci.product.imageUrls != null and !ci.product.imageUrls.isEmpty() ? ci.product.imageUrls[0] : '/images/placeholder.jpg'}"
                         th:alt="${ci.product.getDisplayName()}"/>

                    <!-- content -->
                    <div class="flex-grow-1">
                        <div class="fw-semibold" th:text="${ci.product.name}">Tên sản phẩm</div>
                        <div class="small line-muted">Mã: <span th:text="${ci.product.serialNumber}"></span></div>

                        <!-- số lượng + giá -->
                        <div class="d-flex align-items-center gap-3 mt-2">
                            <div class="qty input-group input-group-sm" style="max-width:160px">
                                <button type="button" class="btn btn-outline-secondary btn-minus"><i class="bi bi-dash"></i></button>
                                <input class="form-control qty-input" type="number" disabled
                                       th:value="${ci.quantity}" min="1"
                                       th:attr="data-price=${ci.price}">
                                <button type="button" class="btn btn-outline-secondary btn-plus"><i class="bi bi-plus"></i></button>
                            </div>
                            <div class="price line-total" th:text="${#numbers.formatDecimal(ci.price * ci.quantity,0,'COMMA',0,'POINT')} + ' đ'">0 đ</div>
                        </div>
                    </div>
                    <!-- CSRF để fetch gửi -->
                    <input type="hidden" id="csrfName" th:value="${_csrf.parameterName}">
                    <input type="hidden" id="csrfToken" th:value="${_csrf.token}">
                    <!-- remove -->
                    <a th:href="@{/cart/remove/{id}(id=${ci.product.id})}" class="btn btn-link btn-sm text-decoration-none btn-icon ms-2"><i class="bi bi-trash3 fs-5"></i></a>
                </div>
            </div>
        </div>

        <!-- Totals -->
        <div class="card-body">
            <div class="row">
                <div class="col-12 col-md-6 ms-auto">
                    <div class="totals-box">
                        <div class="d-flex mb-2"><span class="text-muted">Tạm tính</span>
                            <span class="ms-auto fw-semibold" id="subtotal" th:text="${#numbers.formatDecimal(subtotal?:0,0,'COMMA',0,'POINT')} + ' đ'">0 đ</span></div>
                        <div class="d-flex mb-2"><span class="text-muted">Giảm giá</span>
                            <span class="ms-auto fw-semibold" id="discount" th:text="${#numbers.formatDecimal(discount?:0,0,'COMMA',0,'POINT')} + ' đ'">0 đ</span></div>
                        <div class="d-flex mb-3"><span class="text-muted">Tổng tiền</span>
                            <span class="ms-auto fw-bold text-danger fs-5" id="total" th:text="${#numbers.formatDecimal(total?:0,0,'COMMA',0,'POINT')} + ' đ'">0 đ</span></div>
                        <div class="small text-muted fst-italic mb-3">(Giá tham khảo đã bao gồm VAT)</div>
                        <a th:href="@{/checkout/{cartid}(cartid=${cartid})}" class="btn btn-continue w-100">Tiếp tục</a>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script defer th:src="@{/js/cart.js}"></script>
</body>
</html>
